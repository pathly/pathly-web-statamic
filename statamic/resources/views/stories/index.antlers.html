<script src="{{ mix src='js/stories.js' }}"></script>

<section>
  <h1 class="section-headline">{{ title }}</h1>

  <div class="filter">
    <div>
      <div class="dropdown">
        <button class="dropdown-button {{ if get:cancer_type }}active{{ /if }}">
          {{ if get:cancer_type }}
            {{ taxonomy:cancer_type :slug:is="get:cancer_type | sanitize" }}
              {{ title }}
            {{ /taxonomy:cancer_type }}
          {{ else }}
            Krebsart
          {{ /if }}
        </button>

        <div class="dropdown-menu dropdown-menu--select shadow hidden">
          <input id="type_none" value="none" name="cancer_type" type="radio">
          <label for="type_none">– zurücksetzen –</label>
          <hr>

          {{ taxonomy:cancer_type min_count="1" }}
            <input id="{{ slug }}" value="{{ slug }}" name="cancer_type" type="radio">
            <label for="{{ slug }}">{{ title }}</label>
          {{ /taxonomy:cancer_type }}
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button {{ if get:from_age or get:to_age }}active{{ /if }}">
          {{ if get:from_age && get:to_age }}
            {{ get:from_age | sanitize }} - {{ get:to_age | sanitize }}
          {{ elseif get:from_age }}
            ab {{ get:from_age | sanitize }}
          {{ elseif get:to_age }}
            bis {{ get:to_age | sanitize }}
          {{ else }}
            Alter
          {{ /if }}
        </button>

        <div class="dropdown-menu dropdown-menu--range shadow hidden">
          <input id="from" name="from_age" type="number" value="{{ get:from_age | sanitize }}">
          -
          <input id="to" name="to_age" type="number" value="{{ get:to_age | sanitize }}">
          <input name="age" type="submit">
          <input name="age" type="reset">
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button {{ if get:therapy_type }}active{{ /if }}">
          {{ if get:therapy_type }}
            {{ taxonomy:therapy_type :slug:is="get:therapy_type | sanitize" }}
              {{ title }}
            {{ /taxonomy:therapy_type }}
          {{ else }}
            Therapieform
          {{ /if }}
        </button>

        <div class="dropdown-menu dropdown-menu--select shadow hidden">
          <input id="therapy_none" value="none" name="therapy_type" type="radio">
          <label for="therapy_none">– zurücksetzen –</label>
          <hr>

          {{ taxonomy:therapy_type min_count="1" }}
            <input id="{{ slug }}" value="{{ slug }}" name="therapy_type" type="radio">
            <label for="{{ slug }}">{{ title }}</label>
          {{ /taxonomy:therapy_type }}
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button {{ if get:person_type }}active{{ /if }}">
          {{ if get:person_type == "patient" }}
            Patient:in
          {{ elseif get:person_type == "relative" }}
            Angehörige:r
          {{ else }}
            Betroffenheit
          {{ /if }}
        </button>

        <div class="dropdown-menu dropdown-menu--select shadow hidden">
          <input id="person_none" value="none" name="person_type" type="radio">
          <label for="person_none">– zurücksetzen –</label>
          <hr>

          <input id="patient" value="patient" name="person_type" type="radio">
          <label for="patient">Patient:in</label>
          <input id="relative" value="relative" name="person_type" type="radio">
          <label for="relative">Angehörige:r</label>
        </div>
      </div>
    </div>

    <div>
      <button class="favorites-mode-toggle {{ if get:favorite }}active{{ /if }}"></button>
    </div>
  </div>

  <div class="blog">
    {{ collection:stories paginate="6" as="posts"
    :filter_from_age="get:from_age"
    :filter_to_age="get:to_age"
    :cancer_type:contains="get:cancer_type"
    :therapy_type:contains="get:therapy_type"
    :person_type:contains="get:person_type"
    :filter_favorites="get:favorite"
    query_scope="stories" }}

      <p class="favorites-disclaimer {{ if !get:favorite }}hidden{{ /if }}">Hier kannst du deine Lieblingsgeschichten speichern.
      <br>Achtung: Sobald du die Cookies in deinem Browser löschst, sind auch deine Favoriten weg.</p>

      <div id="stories" class="tiles">
        {{ posts }}
          <div class="card shadow">
            <a href="{{ url }}" target="_blank">
              <article>
                <img src="{{ image }}" alt="{{ alt }}">
                <div>
                  <span>{{ cancer_type:title }}</span>
                  <div class="favorite-toggle favorite-toggle--stories">
                    <input value="{{ id }}" name="favorite" type="checkbox">
                    <label for="favorite"></label>
                  </div>
                </div>

                <h2>{{ name }}, {{ age }}</h2>
              </article>
            </a>
          </div>
        {{ /posts }}
      </div>

      <div class="pagination">
        <ul>
          {{ paginate }}
            {{ if prev_page }}
              <li><a href="{{ prev_page }}"><</a></li>
            {{ else }}
              <li><a href="{{ prev_page }}" class="disabled"><</a></li>
            {{ /if }}

            {{ links:all }}
              <li><a href="{{ url }}">{{ page }}</a></li>
            {{ /links:all }}

            {{ if next_page }}
              <li><a href="{{ next_page }}">></a></li>
            {{ else }}
              <li><a href="{{ next_page }}" class="disabled">></a></li>
            {{ /if }}
          {{ /paginate }}
        </ul>
      </div>
    {{ /collection:stories }}
  </div>
</section>
